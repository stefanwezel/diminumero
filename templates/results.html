{% extends "base.html" %}

{% block title %}{{ get_text('results_title') }}{% endblock %}

{% block content %}
{% if show_perfect_splash or show_splash %}
{% if show_perfect_splash %}
<div id="perfect-splash" class="speed-bonus-overlay" style="display:none">
    <div class="speed-bonus-popup">
        <p>{{ get_text('results_perfect') }}</p>
    </div>
</div>
{% endif %}
{% if show_splash %}
<div id="speed-splash" class="speed-bonus-overlay" style="display:none">
    <div class="speed-bonus-popup">
        <p>{{ get_text('results_speed_bonus') }}</p>
    </div>
</div>
{% endif %}
<script>
    var queue = [
        {% if show_perfect_splash %}'perfect-splash',{% endif %}
        {% if show_splash %}'speed-splash',{% endif %}
    ];
    function showNext() {
        if (!queue.length) return;
        var id = queue.shift();
        var el = document.getElementById(id);
        el.style.display = 'flex';
        setTimeout(function () {
            el.classList.add('speed-bonus-overlay--out');
            setTimeout(function () {
                el.style.display = 'none';
                showNext();
            }, 650);
        }, 1400);
    }
    showNext();
</script>
{% endif %}
<div class="results-page">
    <div class="results-container">
        <img src="{{ url_for('static', filename='logo-512.png') }}" alt="diminumero logo" class="results-logo">
        <h1 class="results-title">{{ get_text('results_complete') }}</h1>
        
        <div class="score-card" title="{{ attempted }} / {{ max_questions }} {{ get_text('info_questions') }}">
            <div class="final-score">
                <span class="score-number">{{ score }}</span>
                <span class="score-divider">/</span>
                <span class="score-total">{{ max_questions }}</span>
            </div>
            <div class="score-label">{{ get_text('results_correct') }}</div>
            <div class="percentage">{{ "%.0f"|format(percentage) }} %</div>
        </div>
        
        <!-- Performance message -->
        <div class="performance-message">
            {% if percentage == 100 %}
                <p class="message-perfect">{{ get_text('results_perfect') }}</p>
            {% elif percentage >= 80 %}
                <p class="message-great">{{ get_text('results_great') }}</p>
            {% elif percentage >= 60 %}
                <p class="message-good">{{ get_text('results_good') }}</p>
            {% else %}
                <p class="message-practice">{{ get_text('results_keep_practicing') }}</p>
            {% endif %}
        </div>
        
        <!-- Speed bonus message -->
        {% if is_speed_bonus %}
        <p class="result-message">{{ get_text('results_speed_bonus') }}</p>
        {% endif %}

        <!-- Action buttons -->
        <div class="results-actions">
            <form action="{{ url_for('start_quiz', lang_code=lang_code) }}" method="POST">
                <input type="hidden" name="mode" value="{{ session.get('mode', 'easy') }}">
                <button type="submit" class="btn-try-again">
                    <img src="{{ url_for('static', filename='icons/icon-tryagain.svg') }}" alt="" class="btn-icon" aria-hidden="true"> {{ get_text('results_try_again') }}
                </button>
            </form>

            {% if has_learn_materials %}
            <a href="{{ url_for('learn', lang_code=lang_code) }}" class="btn btn-primary btn-large">
                <img src="{{ url_for('static', filename='icons/icon-books.svg') }}" alt="" class="btn-icon" aria-hidden="true"> {{ get_text('footer_learn') }}
            </a>
            {% else %}
            <div class="btn btn-primary btn-large results-learn-unavailable">
                <img src="{{ url_for('static', filename='icons/icon-books.svg') }}" alt="" class="btn-icon" aria-hidden="true"> {{ get_text('footer_learn') }}
                <a href="https://github.com/stefanwezel/diminumero/blob/main/ADD_NEW_LEARNING_MATERIALS.md"
                   target="_blank" rel="noopener noreferrer" class="learn-contribute-link">
                    {{ get_text('learn_contribute_link') }}
                </a>
            </div>
            {% endif %}

            <a href="{{ url_for('mode_selection', lang_code=lang_code) }}" class="btn btn-primary btn-large">
                <img src="{{ url_for('static', filename='icons/icon-home.svg') }}" alt="" class="btn-icon" aria-hidden="true"> {{ get_text('results_back_home') }}
            </a>
        </div>
        
        <div class="feedback-section">
            <a href="mailto:wezelstefan@gmail.com?subject={{ get_text('feedback_subject') }}" class="btn btn-feedback">
                <img src="{{ url_for('static', filename='icons/icon-email.svg') }}" alt="" class="btn-icon" aria-hidden="true"> {{ get_text('footer_feedback') }}
            </a>
        </div>
        
        <footer class="page-footer">
            <a href="{{ url_for('privacy') }}" class="footer-link">{{ get_text('footer_privacy') }}</a> | 
            <a href="{{ url_for('imprint') }}" class="footer-link">{{ get_text('footer_imprint') }}</a>
        </footer>
    </div>
</div>
{% endblock %}
